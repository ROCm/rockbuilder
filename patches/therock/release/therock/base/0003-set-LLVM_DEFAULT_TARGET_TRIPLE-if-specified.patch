From be0e6aa2ecbc75d14934ec4510812fb4e1afd6fa Mon Sep 17 00:00:00 2001
From: Mika Laitio <mika.laitio@amd.com>
Date: Thu, 27 Nov 2025 03:52:07 +0000
Subject: [PATCH 3/4] set LLVM_DEFAULT_TARGET_TRIPLE if specified

Set target triple when compiling the amd-llvm
if environment variable
ROCM_SDK_TARGET_TRIPLE has been set.
This fixes the building of TheRock on Mageia Linux.

Signed-off-by: Mika Laitio <mika.laitio@amd.com>
---
 compiler/CMakeLists.txt | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/compiler/CMakeLists.txt b/compiler/CMakeLists.txt
index 9db31320..d31e76c5 100644
--- a/compiler/CMakeLists.txt
+++ b/compiler/CMakeLists.txt
@@ -10,6 +10,9 @@ if(THEROCK_ENABLE_COMPILER)
   if(CMAKE_CXX_COMPILER_ID STREQUAL "GNU")
     list(APPEND _extra_llvm_cmake_args "-DLLVM_ENABLE_PEDANTIC=OFF")
   endif()
+  if(DEFINED ENV{ROCM_SDK_TARGET_TRIPLE})
+    list(APPEND _extra_llvm_cmake_args "-DLLVM_DEFAULT_TARGET_TRIPLE=$ENV{ROCM_SDK_TARGET_TRIPLE}")
+  endif()
 
   # Building Flang is very memory-intensive on systems with many cores. Allow
   # users to specify the level of concurrency for these tasks so they can
-- 
2.43.0

