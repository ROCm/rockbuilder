From 061b7cf18d89bcc168b2a7c47f58cadb870923aa Mon Sep 17 00:00:00 2001
From: Mika Laitio <mika.laitio@amd.com>
Date: Tue, 16 Sep 2025 17:02:28 -0700
Subject: [PATCH 1/4] helper scripts to init, config and build therock

Signed-off-by: Mika Laitio <mika.laitio@amd.com>
---
 rcb_build.bat      |  8 ++++++++
 rcb_build.sh       | 12 ++++++++++++
 rcb_config.bat     |  8 ++++++++
 rcb_config.sh      | 12 ++++++++++++
 rcb_pre_config.bat | 26 ++++++++++++++++++++++++++
 rcb_pre_config.sh  | 15 +++++++++++++++
 6 files changed, 81 insertions(+)
 create mode 100644 rcb_build.bat
 create mode 100755 rcb_build.sh
 create mode 100644 rcb_config.bat
 create mode 100755 rcb_config.sh
 create mode 100644 rcb_pre_config.bat
 create mode 100755 rcb_pre_config.sh

diff --git a/rcb_build.bat b/rcb_build.bat
new file mode 100644
index 00000000..a2fd930c
--- /dev/null
+++ b/rcb_build.bat
@@ -0,0 +1,8 @@
+set "VENV_NAME=.venv"
+set "SCRIPT_DIR=%~dp0"
+
+cd /d "%SCRIPT_DIR%"
+
+echo Activating python virtual environment: "%VENV_NAME%"
+call "%VENV_NAME%\Scripts\activate.bat"
+cmake --build build
diff --git a/rcb_build.sh b/rcb_build.sh
new file mode 100755
index 00000000..963399cd
--- /dev/null
+++ b/rcb_build.sh
@@ -0,0 +1,12 @@
+#!/usr/bin/env bash
+
+export CUR_DIR=$PWD
+echo "rcb_build.sh current directory: $CUR_DIR"
+source ./.venv/bin/activate
+echo "rcb_build.sh python activated"
+CMAKE_VERSION_OUTPUT=$(cmake --version)
+echo "rcb_build.sh CMAKE_VERSION: ${CMAKE_VERSION_OUTPUT}"
+echo "rcb_build.sh therock cmake build command started"
+cmake --build build
+RES=$?
+echo "rcb_build.sh therock cmake build command done, res: $RES"
diff --git a/rcb_config.bat b/rcb_config.bat
new file mode 100644
index 00000000..39e807ca
--- /dev/null
+++ b/rcb_config.bat
@@ -0,0 +1,8 @@
+set "VENV_NAME=.venv"
+set "SCRIPT_DIR=%~dp0"
+
+cd /d "%SCRIPT_DIR%"
+
+echo Activating python virtual environment: "%VENV_NAME%"
+call "%VENV_NAME%\Scripts\activate.bat"
+cmake -B build -GNinja -DTHEROCK_AMDGPU_TARGETS=%RCB_AMDGPU_TARGETS% .
diff --git a/rcb_config.sh b/rcb_config.sh
new file mode 100755
index 00000000..4152f8ec
--- /dev/null
+++ b/rcb_config.sh
@@ -0,0 +1,12 @@
+#!/usr/bin/env bash
+
+export CUR_DIR=$PWD
+echo "rcb_config.sh current directory: $CUR_DIR"
+source ./.venv/bin/activate
+echo "rcb_config.sh python activated"
+CMAKE_VERSION_OUTPUT=$(cmake --version)
+echo "rcb_config.sh CMAKE_VERSION: ${CMAKE_VERSION_OUTPUT}"
+echo "rcb_config.sh therock cmake config command started"
+cmake -B build -GNinja -DTHEROCK_AMDGPU_FAMILIES=${RCB_AMDGPU_TARGETS} .
+RES=$?
+echo "rcb_config.sh therock cmake config command done, res: $RES"
diff --git a/rcb_pre_config.bat b/rcb_pre_config.bat
new file mode 100644
index 00000000..09a68f89
--- /dev/null
+++ b/rcb_pre_config.bat
@@ -0,0 +1,26 @@
+set "VENV_NAME=.venv"
+set "SCRIPT_DIR=%~dp0"
+
+cd /d "%SCRIPT_DIR%"
+
+if not exist "%VENV_NAME%\Scripts\activate.bat" (
+    echo Creating python virtual environment: "%VENV_NAME%"
+    python -m venv "%VENV_NAME%"
+    if errorlevel 1 (
+        echo Error: Failed to create python virtual environment. Exiting.
+        exit /b 1
+    )
+    echo Activating python virtual environment: "%VENV_NAME%"
+    call "%VENV_NAME%\Scripts\activate.bat"
+    python.exe -m pip install --upgrade pip
+    pip install -r requirements.txt
+    pip install windows-curses
+    pip install "dvc[s3]"
+    pip install "cmake>=3.28.0,<4.0.0"
+    echo Python virtual environment created and enabled: "%VENV_NAME%"
+) else (
+    call "%VENV_NAME%\Scripts\activate.bat"
+    echo Python virtual environment enabled: "%VENV_NAME%"
+)
+pip install "dvc[s3]"
+python ./build_tools/fetch_sources.py
diff --git a/rcb_pre_config.sh b/rcb_pre_config.sh
new file mode 100755
index 00000000..4347c43f
--- /dev/null
+++ b/rcb_pre_config.sh
@@ -0,0 +1,15 @@
+#!/usr/bin/env bash
+
+export CUR_DIR=$PWD
+echo "rcb_init.sh current directory: $CUR_DIR"
+python3 -m venv ./.venv && source ./.venv/bin/activate
+echo "rcb_init.sh python activated"
+pip install --upgrade pip
+pip install -r ./requirements.txt
+pip install "dvc[s3]"
+pip install "cmake>=3.28.0,<4.0.0"
+CMAKE_VERSION_OUTPUT=$(cmake --version)
+echo "rcb_init.sh CMAKE_VERSION: ${CMAKE_VERSION_OUTPUT}"
+echo "rcb_init.sh therock source fetch started"
+python ./build_tools/fetch_sources.py
+echo "rcb_init.sh therock source fetch done"
-- 
2.43.0

